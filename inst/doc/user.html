<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="James Hollway and Henrique Sposito" />

<meta name="date" content="2022-06-07" />

<title>Working with manydata</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Working with manydata</h1>
<h4 class="author">James Hollway and Henrique Sposito</h4>
<h4 class="date">2022-06-07</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(manydata)</span></code></pre></div>
<div id="discovering-data" class="section level2">
<h2>Discovering data</h2>
<p>The first thing users of the package will want to do is to identify
datasets that might contribute to their research goals. Since some of
these data packages are too big for CRAN, we expect that their
developers will instead choose to make their packages available on
GitHub. To make it easier to identify all packages in the many packages
universe, we have developed the <code>get_packages()</code> function.
The function lists the many packages available and allow users to
download them.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_packages</span>()</span></code></pre></div>
</div>
<div id="understanding-data" class="section level2">
<h2>Understanding data</h2>
<p>Packages in the many packages universe have the advantage to
facilitate comparison and analysis of multiple datasets in a specific
domain of global governance. This is possible with a particular coding
system which follows the same principles across the different
packages.</p>
<p>In <code>{manystates}</code> for example, all datasets from the
states database contain variables named <code>Beg</code>and
<code>End</code> which represent the beginning and ending date of an
episode of state sovereignty.</p>
<p>In <code>{manyenviron}</code>, the agreements database also have the
<code>Beg</code> and <code>End</code> variables but those are attributed
to treaties (signature and term dates). For the memberships database,
<code>Beg</code> and <code>End</code> represent when a relationship
between states and an agreement starts (either signature, ratification
or entry into force) and ends (either withdrawal or term).</p>
<p>This specific variable name allows the comparison across the datasets
which have different sources but same informations. It enables to point
out the recurrence, difference or absence of observations between the
datasets and extract more robust data when researching on a particular
governance domain.</p>
</div>
<div id="loading-data" class="section level2">
<h2>Loading data</h2>
<p>Let us say that we wish to download the <code>{manystates}</code>
package, which offers a set of datasets related to state actors in
global governance. We can download and install the latest release
version of the <code>{manystates}</code> package using the same function
as before, only specifying which package we want to ‘get’,
‘get_packages(“manystates”)’.</p>
<p>For now, let’s work with the Roman Emperors database included in
manydata. We can get a quick summary of the datasets included in this
package with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">&quot;manydata&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(emperors, <span class="at">package =</span> <span class="st">&quot;manydata&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>emperors</span></code></pre></div>
<pre><code>## $wikipedia
## # A tibble: 68 × 15
##    ID       Beg   End   FullName Birth Death CityBirth ProvinceBirth Rise  Cause
##    &lt;chr&gt;    &lt;mda&gt; &lt;mda&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;
##  1 Augustus -002… 0014… IMPERAT… 0062… 0014… Rome      Italia        Birt… Assa…
##  2 Tiberius 0014… 0037… TIBERIV… 0041… 0037… Rome      Italia        Birt… Assa…
##  3 Caligula 0037… 0041… GAIVS I… 0012… 0041… Antitum   Italia        Birt… Assa…
##  4 Claudius 0041… 0054… TIBERIV… 0009… 0054… Lugdunum  Gallia Lugdu… Birt… Assa…
##  5 Nero     0054… 0068… NERO CL… 0037… 0068… Antitum   Italia        Birt… Suic…
##  6 Galba    0068… 0069… SERVIVS… 0002… 0069… Terracina Italia        Seiz… Assa…
##  7 Otho     0069… 0069… MARCVS … 0032… 0069… Terentin… Italia        Appo… Suic…
##  8 Vitelli… 0069… 0069… AVLVS V… 0015… 0069… Rome      Italia        Seiz… Assa…
##  9 Vespasi… 0069… 0079… TITVS F… 0009… 0079… Falacrine Italia        Seiz… Natu…
## 10 Titus    0079… 0081… TITVS F… 0039… 0081… Rome      Italia        Birt… Natu…
## # … with 58 more rows, and 5 more variables: Killer &lt;chr&gt;, Dynasty &lt;chr&gt;,
## #   Era &lt;chr&gt;, Notes &lt;chr&gt;, Verif &lt;chr&gt;
## 
## $UNRV
## # A tibble: 99 × 7
##    ID               Beg     End     Birth Death FullName                 Dynasty
##    &lt;chr&gt;            &lt;mdate&gt; &lt;mdate&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                    &lt;chr&gt;  
##  1 Augustus         -0027   -0014   63 BC 14    Gaius Julius Caesar Oct… Julio-…
##  2 Tiberius         -0014   0037    42 BC 37    Tiberius Claudius Nero … Julio-…
##  3 Gaius (Caligula) 0037    0041    12    14    Gaius Caesar Germanicus… Julio-…
##  4 Claudius         0041    0054    10 BC 41    Tiberius Claudius Nero … Julio-…
##  5 Nero             0054    0068    37    68    Claudius Nero Caesar (b… Julio-…
##  6 Galba            0068    0069    3 BC  69    Servius Sulpicius Galba… Year o…
##  7 Otho             0069    0069    32    69    Marcus Salvius Otho / I… Year o…
##  8 Vitellius        0069    0069    15    69    Aulus Vitellius / Aulus… Year o…
##  9 Vespasian        0069    0079    9     79    Titus Flavius Vespasian… Year o…
## 10 Titus            0079    0081    39    79    Titus Flavius Vespasian… Flavian
## # … with 89 more rows
## 
## $britannica
## # A tibble: 87 × 3
##    ID              Beg       End     
##    &lt;chr&gt;           &lt;mdate&gt;   &lt;mdate&gt; 
##  1 Augustus        -0031     0014    
##  2 Tiberius        0014      0037    
##  3 Caligula        0037      0041    
##  4 Claudius        0041      0054    
##  5 Nero            0054      0068    
##  6 Galba           0068      0069    
##  7 Otho            0069-01   0069-04 
##  8 Aulus Vitellius 0069-07   0069-12 
##  9 Vespasian       0069      0079    
## 10 Titus           0079      0081    
## # … with 77 more rows</code></pre>
<p>We can see that there are three named datasets relating to emperors
here: <code>wikipedia</code> (dataset assembled from Wikipedia pages),
<code>UNVR</code> (United Nations of Roman Vitrix), and
<code>britannica</code> (Britannica Encyclopedia List of Roman
Emperors). Each of these datasets has their advantages and so we may
wish to understand their differences, summarise variables across them,
and perhaps also rerun models across them.</p>
<p>To retrieve an individual dataset from this database, we can use the
<code>pluck()</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>wikipedia <span class="ot">&lt;-</span> <span class="fu">pluck</span>(emperors, <span class="st">&quot;wikipedia&quot;</span>)</span></code></pre></div>
<p>However, the real value of the various ‘many packages’ is that
multiple datasets relating to the same phenomenon are presented
together.</p>
</div>
<div id="comparing-data" class="section level2">
<h2>Comparing data</h2>
<p>First of all, we want to understand what the differences between the
datasets in a database. One important way to understand the relationship
between these datasets is to understand what their relative advantages
and disadvantages are. For example, one dataset may be long (has many
observations) while another is shorter but wider (has more variables).
One might include details further back in history while the other is
more recent, but include more missing data or less precise data
(i.e. coded at a less granular level) than another with a more
restrictive. Or one might appear complete yet offer less information on
where the original data points were sourced or how certain variables
were coded, while another provides an extensive and transparent codebook
that facilitates replication.</p>
<div id="using-data_source-and-data_contrast" class="section level3">
<h3>Using <code>data_source()</code> and
<code>data_contrast()</code></h3>
<p>We can bring up the database level documentation using:
<code>?emperors</code>. This informs users on the datasets present in
the database as well as the variables in the various datasets. Though,
if we want a more detailed summary of the various levels of data and
sources, we can use <code>data_source()</code> and
<code>data_contrast()</code>.</p>
<p>The <code>data_source()</code> function displays bibliographic
references for the datasets within a database.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_source</span>(<span class="at">pkg =</span> <span class="st">&quot;manydata&quot;</span>, <span class="at">database =</span> <span class="cn">NULL</span>, <span class="at">dataset =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## Component 1 :
##            Reference                                                                                                        
## wikipedia  &quot;(????). &quot;List_of_Roman_emperors.&quot;&lt;tps://en.wikipedia.org/wiki/List_of_Roman_emperors&gt;. Accessed:202&quot; [truncated]
## UNRV       &quot;(????). &quot;Roman Emperor list.&quot;&lt;https://www.unrv.com/government/emperor.php&gt;. Accessed: 2021-07-22.&quot;              
## britannica &quot;(????). &quot;List of Roman emperors.&quot;&lt;https://www.britannica.com/topic/list-of-Roman-emperors-2043294&gt;.&quot; [truncated]</code></pre>
<p>The <code>data_contrast()</code> function returns a data frame with
the key metadata of each level of data objects (many package, database,
and dataset). This metadata includes the following elements:</p>
<ul>
<li>Number of unique observations</li>
<li>Number of rows</li>
<li>Number of columns</li>
<li>Earliest beginning date</li>
<li>Latest end date</li>
<li>Source URL</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_contrast</span>(<span class="at">pkg =</span> <span class="st">&quot;manydata&quot;</span>, <span class="at">database =</span> <span class="cn">NULL</span>, <span class="at">dataset =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## Please specify &#39;approx_range&#39; argument if you want approximate dates to also be expanded
## Please specify &#39;approx_range&#39; argument if you want approximate dates to also be expanded
## Please specify &#39;approx_range&#39; argument if you want approximate dates to also be expanded
## Please specify &#39;approx_range&#39; argument if you want approximate dates to also be expanded
## Please specify &#39;approx_range&#39; argument if you want approximate dates to also be expanded
## Please specify &#39;approx_range&#39; argument if you want approximate dates to also be expanded</code></pre>
<pre><code>## emperors :
##            Unique ID Missing Data Rows Columns         Beg         End
## wikipedia         68        9.9 %   68      15 -0026-01-16  0014-08-19
## UNRV              98       6.06 %   99       7 -0027-01-01 -0014-12-31
## britannica        87          0 %   87       3   -0031\032    0014\032
##                                                                        URL
## wikipedia                           https://github.com/zonination/emperors
## UNRV                           https://www.unrv.com/government/emperor.php
## britannica https://www.britannica.com/topic/list-of-Roman-emperors-2043294</code></pre>
</div>
<div id="an-example-of-inference-sensitivity-to-data-sources" class="section level3">
<h3>An example of inference sensitivity to data sources</h3>
<p>Next we may be interested in whether any relationships we are
interested in or inferences we want to draw are sensitive to which data
we use. That is, we are interested in the robustness of any results to
different data specifications.</p>
<p>We can start by exploring whether our conclusion about when emperors
began their reign would differ depending on which dataset we use. We can
use the <code>purrr::map()</code> function used above, but this time
pass it the <code>mean()</code> function and tell it to operate on just
the “Beg” variable, which represents when emperors began their reign
(removing any NAs). Since manydata datasets are always ordered by “Beg”
(and then “ID”), we can remove any subsequent (duplicated) entries by ID
to concentrate on first appearances.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>emperors <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(ID)) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">mean</span>(Beg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<pre><code>## $wikipedia
## # A tibble: 68 × 1
##    `mean(Beg, na.rm = TRUE)`
##    &lt;chr&gt;                    
##  1 -0026-01-16              
##  2 0014-09-18               
##  3 0037-03-18               
##  4 0041-01-25               
##  5 0054-10-13               
##  6 0068-06-08               
##  7 0069-01-15               
##  8 0069-04-17               
##  9 0069-12-21               
## 10 0079-06-24               
## # … with 58 more rows
## 
## $UNRV
## # A tibble: 98 × 1
##    `mean(Beg, na.rm = TRUE)`
##    &lt;chr&gt;                    
##  1 -0027-07-02              
##  2 -0014-07-02              
##  3 0037-07-02               
##  4 0041-07-02               
##  5 0054-07-02               
##  6 0068-07-01               
##  7 0069-07-02               
##  8 0069-07-02               
##  9 0069-07-02               
## 10 0079-07-02               
## # … with 88 more rows
## 
## $britannica
## # A tibble: 87 × 1
##    `mean(Beg, na.rm = TRUE)`
##    &lt;chr&gt;                    
##  1 &quot;-0031\u001a&quot;            
##  2 &quot;0014-07-02&quot;             
##  3 &quot;0037-07-02&quot;             
##  4 &quot;0041-07-02&quot;             
##  5 &quot;0054-07-02&quot;             
##  6 &quot;0068-07-01&quot;             
##  7 &quot;0069-01-16&quot;             
##  8 &quot;0069-07-16&quot;             
##  9 &quot;0069-07-02&quot;             
## 10 &quot;0079-07-02&quot;             
## # … with 77 more rows</code></pre>
</div>
</div>
<div id="consolidating-data" class="section level2">
<h2>Consolidating data</h2>
<p>Now that we have compared the data and looked at some of the
different inferences drawn, let us examine how to select and consolidate
databases.</p>
<p>The <code>consolidate()</code> function facilitates consolidating a
set of datasets, or a database, from a ‘many’ package into a single
dataset with some combination of the rows and columns. The function
includes separate arguments for rows and columns, as well as for how to
resolve conflicts in observations across datasets. The key argument
indicates the column to collapse datasets by. This provides users with
considerable flexibility in how they combine data.</p>
<p>For example, users may wish to see units and variables coded in “any”
dataset (i.e. units or variables present in at least one of the datasets
in the database) or units and variables coded in “every” dataset
(i.e. units or variables present in all of the datasets in the
database).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;any&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;any&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;coalesce&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 137 × 15
##    ID        CityBirth  ProvinceBirth Rise  Cause Killer Era   Notes Verif Birth
##    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 Augustus  Rome       Italia        Birt… Assa… Wife   Prin… birt… Redd… 0062…
##  2 Tiberius  Rome       Italia        Birt… Assa… Other… Prin… birt… Redd… 0041…
##  3 Caligula  Antitum    Italia        Birt… Assa… Senate Prin… assa… Redd… 0012…
##  4 Claudius  Lugdunum   Gallia Lugdu… Birt… Assa… Wife   Prin… birt… Redd… 0009…
##  5 Nero      Antitum    Italia        Birt… Suic… Senate Prin… &lt;NA&gt;  Redd… 0037…
##  6 Galba     Terracina  Italia        Seiz… Assa… Other… Prin… birt… Redd… 0002…
##  7 Otho      Terentinum Italia        Appo… Suic… Other… Prin… &lt;NA&gt;  &lt;NA&gt;  0032…
##  8 Vitellius Rome       Italia        Seiz… Assa… Other… Prin… &lt;NA&gt;  &lt;NA&gt;  0015…
##  9 Vespasian Falacrine  Italia        Seiz… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0009…
## 10 Titus     Rome       Italia        Birt… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0039…
## # … with 127 more rows, and 5 more variables: Death &lt;chr&gt;, FullName &lt;chr&gt;,
## #   Dynasty &lt;chr&gt;, Beg &lt;mdate&gt;, End &lt;mdate&gt;</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;every&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;every&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;coalesce&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 41 × 3
##    ID        Beg         End       
##    &lt;chr&gt;     &lt;mdate&gt;     &lt;mdate&gt;   
##  1 Augustus  -0026-01-16 0014-08-19
##  2 Tiberius  0014-09-18  0037-03-16
##  3 Claudius  0041-01-25  0054-10-13
##  4 Nero      0054-10-13  0068-06-09
##  5 Galba     0068-06-08  0069-01-15
##  6 Otho      0069-01-15  0069-04-16
##  7 Vespasian 0069-12-21  0079-06-24
##  8 Titus     0079-06-24  0081-09-13
##  9 Domitian  0081-09-14  0096-09-18
## 10 Nerva     0096-09-18  0098-01-27
## # … with 31 more rows</code></pre>
<p>Users can also choose how they want to resolve conflicts between
observations in <code>consolidate()</code> with several ‘resolve’
methods:</p>
<ul>
<li>coalesce: the first non-NA value</li>
<li>max: the largest value</li>
<li>min: the smallest value</li>
<li>mean: the average value</li>
<li>median: the median value</li>
<li>random: a random value</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;any&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;every&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;max&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 137 × 3
##    ID        Beg           End       
##    &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;     
##  1 Augustus  &quot;-0031\u001a&quot; 0014-08-19
##  2 Tiberius  &quot;0014-09-18&quot;  0037-03-16
##  3 Caligula  &quot;0037-03-18&quot;  0041-01-24
##  4 Claudius  &quot;0041-01-25&quot;  0054-10-13
##  5 Nero      &quot;0054-10-13&quot;  0068-06-09
##  6 Galba     &quot;0068-06-08&quot;  0069-01-15
##  7 Otho      &quot;0069-01-15&quot;  0069-04-16
##  8 Vitellius &quot;0069-04-17&quot;  0069-12-20
##  9 Vespasian &quot;0069-12-21&quot;  0079-06-24
## 10 Titus     &quot;0079-06-24&quot;  0081-09-13
## # … with 127 more rows</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;every&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;any&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;min&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 41 × 15
##    ID        CityBirth  ProvinceBirth Rise  Cause Killer Era   Notes Verif Birth
##    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 Augustus  Rome       Italia        Birt… Assa… Wife   Prin… birt… Redd… 0062…
##  2 Tiberius  Rome       Italia        Birt… Assa… Other… Prin… birt… Redd… 0041…
##  3 Claudius  Lugdunum   Gallia Lugdu… Birt… Assa… Wife   Prin… birt… Redd… 0009…
##  4 Nero      Antitum    Italia        Birt… Suic… Senate Prin… &lt;NA&gt;  Redd… 0037…
##  5 Galba     Terracina  Italia        Seiz… Assa… Other… Prin… birt… Redd… 0002…
##  6 Otho      Terentinum Italia        Appo… Suic… Other… Prin… &lt;NA&gt;  &lt;NA&gt;  0032…
##  7 Vespasian Falacrine  Italia        Seiz… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0009…
##  8 Titus     Rome       Italia        Birt… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0039…
##  9 Domitian  Rome       Italia        Birt… Assa… Court… Prin… &lt;NA&gt;  &lt;NA&gt;  0051…
## 10 Nerva     Narni      Italia        Appo… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0030…
## # … with 31 more rows, and 5 more variables: Death &lt;chr&gt;, FullName &lt;chr&gt;,
## #   Dynasty &lt;chr&gt;, Beg &lt;chr&gt;, End &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;every&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;every&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;mean&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 41 × 3
##    ID        Beg         End       
##    &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;     
##  1 Augustus  -0026-01-16 0014-08-19
##  2 Tiberius  0014-09-18  0037-03-16
##  3 Claudius  0041-01-25  0054-10-13
##  4 Nero      0054-10-13  0068-06-09
##  5 Galba     0068-06-08  0069-01-15
##  6 Otho      0069-01-15  0069-04-16
##  7 Vespasian 0069-12-21  0079-06-24
##  8 Titus     0079-06-24  0081-09-13
##  9 Domitian  0081-09-14  0096-09-18
## 10 Nerva     0096-09-18  0098-01-27
## # … with 31 more rows</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;any&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;any&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;median&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 137 × 15
##    ID        CityBirth  ProvinceBirth Rise  Cause Killer Era   Notes Verif Birth
##    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 Augustus  Rome       Italia        Birt… Assa… Wife   Prin… birt… Redd… 0062…
##  2 Tiberius  Rome       Italia        Birt… Assa… Other… Prin… birt… Redd… 0041…
##  3 Caligula  Antitum    Italia        Birt… Assa… Senate Prin… assa… Redd… 0012…
##  4 Claudius  Lugdunum   Gallia Lugdu… Birt… Assa… Wife   Prin… birt… Redd… 0009…
##  5 Nero      Antitum    Italia        Birt… Suic… Senate Prin… &lt;NA&gt;  Redd… 0037…
##  6 Galba     Terracina  Italia        Seiz… Assa… Other… Prin… birt… Redd… 0002…
##  7 Otho      Terentinum Italia        Appo… Suic… Other… Prin… &lt;NA&gt;  &lt;NA&gt;  0032…
##  8 Vitellius Rome       Italia        Seiz… Assa… Other… Prin… &lt;NA&gt;  &lt;NA&gt;  0015…
##  9 Vespasian Falacrine  Italia        Seiz… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0009…
## 10 Titus     Rome       Italia        Birt… Natu… Disea… Prin… &lt;NA&gt;  &lt;NA&gt;  0039…
## # … with 127 more rows, and 5 more variables: Death &lt;chr&gt;, FullName &lt;chr&gt;,
## #   Dynasty &lt;chr&gt;, Beg &lt;chr&gt;, End &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;every&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;every&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;random&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 41 × 3
##    ID        Beg           End         
##    &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;       
##  1 Augustus  &quot;-0031\u001a&quot; &quot;0014\u001a&quot;
##  2 Tiberius  &quot;0014-09-18&quot;  &quot;0037&quot;      
##  3 Claudius  &quot;0041&quot;        &quot;0054&quot;      
##  4 Nero      &quot;0054&quot;        &quot;0068&quot;      
##  5 Galba     &quot;0068&quot;        &quot;0069-01-15&quot;
##  6 Otho      &quot;0069-01-15&quot;  &quot;0069-04&quot;   
##  7 Vespasian &quot;0069&quot;        &quot;0079-06-24&quot;
##  8 Titus     &quot;0079&quot;        &quot;0081&quot;      
##  9 Domitian  &quot;0081-09-14&quot;  &quot;0096-09-18&quot;
## 10 Nerva     &quot;0096&quot;        &quot;0098-01-27&quot;
## # … with 31 more rows</code></pre>
<p>Users can even specify how conflicts for different variables should
be ‘resolved’:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;any&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;every&quot;</span>, <span class="at">resolve =</span> <span class="fu">c</span>(<span class="at">Beg =</span> <span class="st">&quot;min&quot;</span>, <span class="at">End =</span> <span class="st">&quot;max&quot;</span>), <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 137 × 3
##    ID        Beg         End       
##    &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;     
##  1 Augustus  -0026-01-16 0014-08-19
##  2 Tiberius  -0014       0037-03-16
##  3 Caligula  0037-03-18  0041-01-24
##  4 Claudius  0041        0054-10-13
##  5 Nero      0054        0068-06-09
##  6 Galba     0068        0069-01-15
##  7 Otho      0069        0069-04-16
##  8 Vitellius 0069-04-17  0069-12-20
##  9 Vespasian 0069        0079-06-24
## 10 Titus     0079        0081-09-13
## # … with 127 more rows</code></pre>
<p>Alternatively, users can “favour” a dataset in a database over
others:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> <span class="fu">favour</span>(emperors, <span class="st">&quot;UNRV&quot;</span>), <span class="at">rows =</span> <span class="st">&quot;every&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;any&quot;</span>, <span class="at">resolve =</span> <span class="st">&quot;coalesce&quot;</span>, <span class="at">key =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 41 × 15
##    ID    FullName Birth Death CityBirth ProvinceBirth Rise  Cause Killer Dynasty
##    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 Augu… Gaius J… 63 BC 14    Rome      Italia        Birt… Assa… Wife   Julio-…
##  2 Tibe… Tiberiu… 42 BC 37    Rome      Italia        Birt… Assa… Other… Julio-…
##  3 Clau… Tiberiu… 10 BC 41    Lugdunum  Gallia Lugdu… Birt… Assa… Wife   Julio-…
##  4 Nero  Claudiu… 37    68    Antitum   Italia        Birt… Suic… Senate Julio-…
##  5 Galba Servius… 3 BC  69    Terracina Italia        Seiz… Assa… Other… Year o…
##  6 Otho  Marcus … 32    69    Terentin… Italia        Appo… Suic… Other… Year o…
##  7 Vesp… Titus F… 9     79    Falacrine Italia        Seiz… Natu… Disea… Year o…
##  8 Titus Titus F… 39    79    Rome      Italia        Birt… Natu… Disea… Flavian
##  9 Domi… Titus F… 51    96    Rome      Italia        Birt… Assa… Court… Flavian
## 10 Nerva Marcus … 30    98    Narni     Italia        Appo… Natu… Disea… Adopti…
## # … with 31 more rows, and 5 more variables: Era &lt;chr&gt;, Notes &lt;chr&gt;,
## #   Verif &lt;chr&gt;, Beg &lt;mdate&gt;, End &lt;mdate&gt;</code></pre>
<p>Users can, even, declare multiple key ID columns to consolidate a
database or multiple datasets:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">consolidate</span>(<span class="at">database =</span> emperors, <span class="at">rows =</span> <span class="st">&quot;any&quot;</span>, <span class="at">cols =</span> <span class="st">&quot;any&quot;</span>, <span class="at">resolve =</span> <span class="fu">c</span>(<span class="at">Death =</span> <span class="st">&quot;max&quot;</span>, <span class="at">Cause =</span> <span class="st">&quot;coalesce&quot;</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">key =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Beg&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 201 × 4
##    ID        Beg         Cause          Death     
##    &lt;chr&gt;     &lt;mdate&gt;     &lt;chr&gt;          &lt;chr&gt;     
##  1 Augustus  -0026-01-16 Assassination  0014-08-19
##  2 Tiberius  0014-09-18  Assassination  0037-03-16
##  3 Caligula  0037-03-18  Assassination  0041-01-24
##  4 Claudius  0041-01-25  Assassination  0054-10-13
##  5 Nero      0054-10-13  Suicide        0068-06-09
##  6 Galba     0068-06-08  Assassination  0069-01-15
##  7 Otho      0069-01-15  Suicide        0069-04-16
##  8 Vitellius 0069-04-17  Assassination  0069-12-20
##  9 Vespasian 0069-12-21  Natural Causes 0079-06-24
## 10 Titus     0079-06-24  Natural Causes 0081-09-13
## # … with 191 more rows</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
